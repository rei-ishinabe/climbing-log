<% if user_signed_in? %>
  <div class="container mt-3 ">
    <div class="row justify-content-center">
      <div class="col-12 col-md-6">
        <% if @routes.exists? %>
          <div class="card  px-2 py-1 mt-1">
            <div>最後に登った日：
              <%= @routes.joins(:logs).order(date: 'DESC').first.logs.order(date: 'DESC').first.date if @routes.exists? %>
            </div>
            <div>完登本数：
              <% sent_count = 0 %>
              <% @routes.each do |route| %>
                <% sent_count += 1 if route.sent %>
              <% end %>
              <%= sent_count %>
            </div>
            <div>クライミング日数：
              <%= @routes.joins(:logs).where('user_id = ?', current_user).count('DISTINCT date') if @routes.exists? %>
            </div>
            <div>ボルダー最高グレード：
              <% boulder =  @routes.joins(:logs).where('user_id = ? and category_id = ? and logs.status_id < ?', current_user, 1, 4).order(grade_id: 'DESC').order(sub_grade_id: 'DESC').first if @routes.exists? %>
              <% unless boulder.nil? %>
                <%= link_to route_path(boulder) do %>
                <%= "#{boulder.combined_grade} (#{boulder.logs.where('status_id < ?', 4).first.date} #{boulder.gym.name})" %>
                <% end %>
              <% end %>
              </div>
            <div class="mb-1">リード最高グレード：
              <% lead = @routes.joins(:logs).where('user_id = ? and category_id = ? and logs.status_id < ?', current_user, 2, 4).order(grade_id: 'DESC').order(sub_grade_id: 'DESC').first if @routes.exists? %>
              <% unless lead.nil? %>
                <%= link_to route_path(lead) do %>
                  <%= "#{lead.combined_grade} (#{lead.logs.where('status_id < ?', 4).first.date} #{lead.gym.name})" %>
                <% end %>
              <% end %>
            </div>
          </div>
        <% else %>
          <h4 class="text-center my-2">クラログαとは？</h4>
            <div>日々、ボルダリングジム、クライミングジムで登った記録をカンタンに保存・管理できるツールです。登った本数やグレードの推移などもひと目で確認できます。</div>
          <h4 class="text-center mt-3 mb-3">使い方</h4>
          <div class="card p-2 mb-3">
            <h5><i class="fas fa-search"></i> Step 1 - ジムを検索/選択 </h5>
            <div>クラログαに登録されている日本全国のジムを、ジム名などで検索して選択します。</div>
          </div>
          <div class="card p-1 mb-3">
            <h5><i class="fas fa-plus-circle"></i> Step 2 - 課題を登録 </h5>
            <div>ジムを選択したら、課題名やグレードなどを登録します。</div>
          </div>
          <div class="card p-1 mb-3">
            <h5><i class="fas fa-tasks"></i> Step 3 - ログを追加 </h5>
            <div>登録した課題に、トライしたログを追加します。</div>
          </div>
          <%= link_to  gyms_path, class: "btn btn-primary btn-block btn-lg" do %>
            <i class="fas fa-search"></i> Step 1 - ジム検索/選択画面へ進む
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
<% else %>
  <div class="banner" style="background-image: linear-gradient(rgba(0,0,0,0.3),rgba(0,0,0,0.1)), url(<%= asset_path 'bouldering-climber-climbing-9606.jpg' %>);">
    <div class="container text-center">
      <h1 style="font-size: 48px;" class="mb-5">クラログα</h1>
      <p class="mb-5">クライミングジム、ボルダリングジムで登った記録をつけて、どんどんレベルアップ！</p>
      <p><a class="btn btn-primary" href="/users/sign_up">無料アカウント登録</a></p>
      <p><a href="/users/sign_in" style="font-size: 14px; color: white;">ログイン</a></p>
    </div>
  </div>
<% end %>
